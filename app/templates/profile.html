

{% extends 'base.html' %}
{% block title %}Your Profile{% endblock %}
{% block content %}
<h2>Authenticated User</h2>
<ul>
    <li><strong>Auth0 ID:</strong> {{ user.sub }}</li>
    <li><strong>Email:</strong> {{ user.email }}</li>
    <li><strong>Name:</strong> {{ user.name or 'Not set' }}</li>
    {% if user.picture %}
    <li><img src="{{ user.picture }}" alt="Avatar" style="max-height:64px;border-radius:50%" /></li>
    {% endif %}
</ul>

<h2>Local Profile</h2>
{% if request.query_params.get('e') == 'csrf' %}
<p class="error">CSRF validation failed. Please try again.</p>
{% elif request.query_params.get('s') == '1' %}
<p class="success">Profile updated.</p>
{% elif request.query_params.get('s') == 'name_updated' %}
<p class="success">Name updated successfully.</p>
{% endif %}


<h3>Change Name</h3>
<form method="post" action="/profile/update">
    <input type="hidden" name="csrf_token" value="{{ user.csrf_token }}" />
    <label>First Name
        <input type="text" name="first_name" value="{{ db_user.first_name if db_user else '' }}" maxlength="100" required />
    </label>
    <label>Last Name
        <input type="text" name="last_name" value="{{ db_user.last_name if db_user else '' }}" maxlength="100" required />
    </label>
    <button type="submit">Change Name</button>
</form>

{% if db_user %}
<details>
    <summary>Raw DB Row (for debugging)</summary>
    <pre>{{ db_user | tojson(indent=2) }}</pre>
</details>
{% endif %}
{% endblock %}
